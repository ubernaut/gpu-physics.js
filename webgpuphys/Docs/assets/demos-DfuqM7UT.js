import{W as j,V as c,P as A,G as V,O as W,c as D}from"./orbitControls-Bz_JsIjz.js";import{B as M}from"./boxRenderer-DyEUWp37.js";async function Y(){const i=document.getElementById("canvas");document.getElementById("error");const l=document.getElementById("bodyCount"),v=document.getElementById("fps"),t={stiffness:1700,damping:6,friction:2,drag:.3,gravityY:-2,fixedTimeStep:1/120,radius:.05,sphereRadius:.8,showParticles:!0,paused:!1,boxesToAdd:12},e=new j({maxBodies:2048,maxParticles:32768,radius:t.radius,stiffness:t.stiffness,damping:t.damping,friction:t.friction,drag:t.drag,fixedTimeStep:t.fixedTimeStep,gravity:new c(0,t.gravityY,0),boxSize:new c(20,20,20),gridPosition:new c(-20,0,-20),gridResolution:new c(128,64,128),maxSubSteps:8});await e.ready();const x=new M(e.getDevice(),i),w=new A(e.getDevice()),S=new V(e.getDevice(),x.format,{size:40,height:0}),E=new W(i,{radius:18,target:[0,.5,0]}),d=3,y=t.radius*d*.8,C=D(1,new c(y,y,y)),p=[0,0,0,1];function T(n,r,a){const s=e.addBody(n,r,a,p[0],p[1],p[2],p[3],1,C.x,C.y,C.z),f=t.radius*2.01;for(let u=0;u<d;u++)for(let g=0;g<d;g++)for(let m=0;m<d;m++)if(u===0||u===d-1||g===0||g===d-1||m===0||m===d-1){const I=(u-(d-1)*.5)*f,z=(g-(d-1)*.5)*f,G=(m-(d-1)*.5)*f;e.addParticle(s,I,z,G)}}function b(n){for(let r=0;r<n;r++){const a=(Math.random()-.5)*6,s=1+r*t.radius*1.5,f=(Math.random()-.5)*6;T(a,s,f)}l.textContent=e.bodyCount.toString()}b(24),e.setSphereRadius(0,t.sphereRadius),e.setSpherePosition(0,0,1.2,0),e.step(e.fixedTimeStep||1/60);const o=new window.lil.GUI({title:"Physics"});o.add(t,"stiffness",100,5e3,10).onChange(n=>e.stiffness=n),o.add(t,"damping",0,20,.1).onChange(n=>e.damping=n),o.add(t,"friction",0,5,.1).onChange(n=>e.friction=n),o.add(t,"drag",0,2,.05).onChange(n=>e.drag=n),o.add(t,"fixedTimeStep",1/240,1/30,5e-4).onChange(n=>e.fixedTimeStep=n),o.add(t,"gravityY",-10,10,.1).onChange(n=>e.gravity=new c(0,n,0)),o.add(t,"sphereRadius",.1,3,.05).onChange(n=>e.setSphereRadius(0,n)),o.add(t,"showParticles").name("render particles"),o.add(t,"paused"),o.add(t,"boxesToAdd",1,200,1).name("add count"),o.add({add:()=>b(t.boxesToAdd)},"add").name("add boxes");let P=performance.now(),B=0,h=0;function R(){const n=performance.now(),r=(n-P)*.001;P=n,B++,h+=r,h>=1&&(v.textContent=Math.round(B/h).toString(),B=0,h=0),t.paused||e.step(r);const a=E.getViewProj(i.width/i.height);x.updateBindGroup(e.getBodyPositionBuffer(),e.getBodyQuaternionBuffer()),w.updateBindGroup(e.getParticleWorldPositionBuffer()),w.updateViewProj(a,e.radius),S.update(a,{gridSize:.5,lineWidth:.04,height:0}),x.render(e.bodyCount,{viewProj:a,drawExtras:s=>{S.record(s),t.showParticles&&w.record(s,e.particleCount)}}),l.textContent=e.bodyCount.toString(),requestAnimationFrame(R)}R()}Y().catch(i=>{const l=document.getElementById("error");l.textContent=`Error: ${i.message||i}`,console.error(i)});
